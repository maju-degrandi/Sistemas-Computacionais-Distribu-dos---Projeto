#!/usr/bin/env bash

echo "Activating virtual environment..."
poetry shell

BLACK_CMD="black"
ISORT_CMD="isort"
PRETTIER_CMD="prettier"

# Check if Black is installed
if ! command -v "$BLACK_CMD" &> /dev/null; then
    echo "Error: Black is not installed"
    exit 1
fi

# Check if Isort is installed
if ! command -v "$ISORT_CMD" &> /dev/null; then
    echo "Error: Isort is not installed"
    exit 1
fi

# Get a list of all python files that have been staged
PY_STAGED_FILES=$(git diff --cached --name-only | grep '\.py$')

# Check if there are any staged files
if [ -z "$PY_STAGED_FILES" ]; then
    echo "No python files to format."
    exit 0
fi

echo "Formatting staged python files with Black..."

# Format each staged file and stage it
for FILE in $PY_STAGED_FILES; do
    "$BLACK_CMD" "$FILE"
    "$ISORT_CMD" "$FILE"
    git add "$FILE"
done

echo "Staged python files have been formatted with Black."

# Continue with the commit
exit 0